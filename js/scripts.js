!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.lscache=b()}(this,function(){function a(){var a="__lscachetest__",c=a;if(void 0!==n)return n;try{h(a,c),i(a),n=!0}catch(a){n=!!b(a)}return n}function b(a){return!!(a&&"QUOTA_EXCEEDED_ERR"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name||"QuotaExceededError"===a.name)}function c(){return void 0===o&&(o=null!=window.JSON),o}function d(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");
}function e(a){return a+q}function f(){return Math.floor((new Date).getTime()/s)}function g(a){return localStorage.getItem(p+u+a)}function h(a,b){localStorage.removeItem(p+u+a),localStorage.setItem(p+u+a,b)}function i(a){localStorage.removeItem(p+u+a)}function j(a){for(var b=new RegExp("^"+p+d(u)+"(.*)"),c=localStorage.length-1;c>=0;--c){var f=localStorage.key(c);f=f&&f.match(b),f=f&&f[1],f&&f.indexOf(q)<0&&a(f,e(f))}}function k(a){var b=e(a);i(a),i(b)}function l(a){var b=e(a),c=g(b);if(c){var d=parseInt(c,r);
if(f()>=d)return i(a),i(b),!0}}function m(a,b){v&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+a),b&&window.console.warn("lscache - The error was: "+b.message))}var n,o,p="lscache-",q="-cacheexpiration",r=10,s=6e4,t=Math.floor(864e13/s),u="",v=!1,w={set:function(d,l,n){if(a()){if("string"!=typeof l){if(!c())return;try{l=JSON.stringify(l)}catch(a){return}}try{h(d,l)}catch(a){if(!b(a))return void m("Could not add item with key '"+d+"'",a);var o,p=[];j(function(a,b){
var c=g(b);c=c?parseInt(c,r):t,p.push({key:a,size:(g(a)||"").length,expiration:c})}),p.sort(function(a,b){return b.expiration-a.expiration});for(var q=(l||"").length;p.length&&q>0;)o=p.pop(),m("Cache is full, removing item with key '"+d+"'"),k(o.key),q-=o.size;try{h(d,l)}catch(a){return void m("Could not add item with key '"+d+"', perhaps it's too big?",a)}}n?h(e(d),(f()+n).toString(r)):i(e(d))}},get:function(b){if(!a())return null;if(l(b))return null;var d=g(b);if(!d||!c())return d;try{return JSON.parse(d);
}catch(a){return d}},remove:function(b){a()&&k(b)},supported:function(){return a()},flush:function(){a()&&j(function(a){k(a)})},flushExpired:function(){a()&&j(function(a){l(a)})},setBucket:function(a){u=a},resetBucket:function(){u=""},enableWarnings:function(a){v=a}};return w}),function(){function a(a){function d(){for(;h=k<j.length&&a>l;){var b=k++,d=j[b],f=c.call(d,1);f.push(e(b)),++l,d[0].apply(null,f)}}function e(a){return function(b,c){--l,null==n&&(null!=b?(n=b,k=m=NaN,f()):(j[a]=c,--m?h||d():f()));
}}function f(){null!=n?o(n):i?o(n,j):o.apply(null,[n].concat(j))}var g,h,i,j=[],k=0,l=0,m=0,n=null,o=b;return a||(a=1/0),g={defer:function(){return n||(j.push(arguments),++m,d()),g},await:function(a){return o=a,i=!1,m||f(),g},awaitAll:function(a){return o=a,i=!0,m||f(),g}}}function b(){}var c=[].slice;a.version="1.0.7","function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.queue=a}(),function(a){var b=[],c=function(){},d={defaultPath:"/",
before:c,on:c,notfound:c},e={current:null,previous:null,config:function(a){for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return e},add:function(a,c,d){return a&&c&&("function"==typeof c&&(d=c,c=null),b.push({path:a,name:c,fn:d||function(){}})),e},go:function(a){return location.hash=a,e},back:function(a){return e.previous?(history.back(),e.previous=null):a&&(location.hash=a),e}},f=function(){var a=location.hash.slice(1),c=!1,f=e.current;a||(a=d.defaultPath),f&&f!=e.previous&&(e.previous=f),e.current=a;
for(var g=0,h=b.length;h>g&&!c;g++){var i=b[g],j=i.path,k=i.name,l=i.fn;if("string"==typeof j)j.toLowerCase()==a.toLowerCase()&&(d.before.call(e,j,k),l.call(e),d.on.call(e,j,k),c=!0);else{var m=a.match(j);m&&(d.before.call(e,j,k,m),l.apply(e,m),d.on.call(e,j,k,m),c=!0)}}return c||d.notfound.call(e),e};e.init=function(b){return a.addEventListener("hashchange",f),f()},e.reload=f,a.ruto=e}(window);var Yokuto=function(){var a=function(a,b){if(!a||1!==a.nodeType)return!1;var c=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector||a.msMatchesSelector;
return c.call(a,b)},b=function(b,c){var d=!1;do d=a(b,c);while(!d&&(b=b.parentNode)&&b.ownerDocument);return d?b:!1},c=function(a,b){if(!a)return this;b||(b=document);var c;"string"!=typeof a?(this.selector="",c=[a]):(this.selector=a,c=[].slice.call(b.querySelectorAll(a)));for(var d=this.length=c.length,e=0;d>e;e++)this[e]=c[e];return this};return c.prototype={each:function(a){for(var b=this.length,c=0;b>c;c++){var d=this[c];a.call(d,d,c)}return this},on:function(a,c,d,e){return"string"!=typeof c?(e=d,
d=c,this.each(function(b){a.split(" ").forEach(function(a){b.addEventListener(a,d,e||!1)})})):this.each(function(f){a.split(" ").forEach(function(a){f.addEventListener(a,function(a){var e=b(a.target,c);e&&d.call(e,a)},e||!1)})}),this},trigger:function(a){if(!this.length)return this;var b=this[0],c=document.createEvent("MouseEvents"),d="dblclick"==a?2:1,e="contextmenu"==a?2:0;return c.initEvent(a,!0,!0,document.defaultView,d,0,0,0,0,!1,!1,!1,!1,e,b),b.dispatchEvent(c),this},find:function(a){return new c(a,this[0]);
},parent:function(){var a=this[0];return new c(a.parentElement||a.parentNode)},next:function(){var a=this[0];return new c(a.nextElementSibling||a.nextSibling)},prev:function(){var a=this[0];return new c(a.previousElementSibling||a.previousSibling)},addClass:function(a){return this.each(function(b){b.classList.add(a)}),this},removeClass:function(a){return this.each(function(b){b.classList.remove(a)}),this},toggleClass:function(a){return this.each(function(b){b.classList.toggle(a)}),this},html:function(a){
return this.length?a?(this[0].innerHTML=a,this):this[0].innerHTML:this},attr:function(a){return this.length?this[0].getAttribute(a):""},data:function(a){return this.length?this[0].getAttribute("data-"+a):void 0},text:function(a){if(!this.length)return"";var b=this[0];return a?(b.textContent=a,this):b.textContent},val:function(a){if(!this.length)return"";var b=this[0];return"string"==typeof a?(b.value=a,this):b.value},focus:function(){return this.length&&this[0].focus&&this[0].focus(),this},blur:function(){
return this.length&&this[0].blur&&this[0].blur(),this}},function(a){return new c(a)}}();"$"in window||(window.$=Yokuto),function(){if(window.addEventListener){var a="2",b=lscache.get("busDataVersion");if(a!=b&&localStorage&&localStorage.length&&localStorage.removeItem){for(var c=localStorage.length-1;c>=0;--c){var d=localStorage.key(c);0===d.indexOf("__amplify__bus")&&localStorage.removeItem(d)}lscache.flush(),lscache.set("busDataVersion",a)}var e,f={busStops:"bus-stops.json",busServices:"bus-services.json",
busService:"bus-services/{{no}}.json",busStopsServices:"bus-stops-services.json"},g=function(a,b,c){2==arguments.length&&(c=b,b={});var d=lscache.get(a);if(d)c(null,d);else{var e=new XMLHttpRequest,g="data/2/"+f[a.split("-")[0]];for(p in b)g=g.replace("{{"+p+"}}",b[p]);e.onload=function(){try{var b=JSON.parse(this.responseText);c(null,b),lscache.set(a,b,1440)}catch(a){c(a)}},e.onerror=e.onabort=c,e.open("get",g,!0),e.send()}},h=window.innerWidth<=640,i=[function(a){g("busStops",a)},function(a){g("busServices",a);
},function(a){g("busStopsServices",a)},function(a){function b(){var b=new google.maps.LatLng(1.352083,103.819836),c=new google.maps.Map(document.getElementById("map"),{mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,keyboardShortcuts:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM}});h&&(c.setOptions({overviewMapControl:!1,zoomControl:!1}),google.maps.event.addListener(c,"dragstart",function(){$("body").addClass("header-collapsed")}));var d=new google.maps.LatLngBounds(new google.maps.LatLng(1.25352193438281,103.62192147229632),new google.maps.LatLng(1.50129709375363,103.99983438993593));
c.fitBounds(d);var f={url:"assets/images/bus-sprite.png",scaledSize:new google.maps.Size(78,84)};if(e={location:{url:f.url,scaledSize:f.scaledSize,size:new google.maps.Size(18,19),anchor:new google.maps.Point(9,9.5),origin:new google.maps.Point(48,0)},circle:{url:f.url,scaledSize:f.scaledSize,size:new google.maps.Size(18,19),anchor:new google.maps.Point(9,9.5),origin:new google.maps.Point(30,0)},dot:{url:f.url,scaledSize:f.scaledSize,size:new google.maps.Size(26,38),origin:new google.maps.Point(0,46)
},a:{url:f.url,scaledSize:f.scaledSize,size:new google.maps.Size(26,38),origin:new google.maps.Point(26,46)},b:{url:f.url,scaledSize:f.scaledSize,size:new google.maps.Size(26,38),origin:new google.maps.Point(52,46)}},navigator.geolocation){var g=document.createElement("a");g.id="geolocation-control",g.href="#",g.innerHTML='<svg class="icon icon-circle"><use xlink:href="#location-arrow"></use></svg>',c.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(g);var i,j=new google.maps.Marker({map:c,
clickable:!1,title:"Current location",icon:e.location,cursor:"default",visible:!1,zIndex:9001}),k=new google.maps.Circle({map:c,clickable:!1,fillColor:"#00b4d2",fillOpacity:.1,strokeWeight:0,visible:!1,zIndex:9e3}),l=!1,m=function(){navigator.geolocation.clearWatch(i),l=!1,k.setVisible(!1),j.setVisible(!1),$("#geolocation-control").removeClass("active")};$("#map").on("click","#geolocation-control",function(a){if(a.preventDefault(),l){var b=j.getPosition();c.getBounds().contains(b)?m():c.panTo(b)}else{
var e=!1;i=navigator.geolocation.watchPosition(function(a){l=!0;var b=a.coords,f=new google.maps.LatLng(b.latitude,b.longitude);if(k.setCenter(f),k.setRadius(b.accuracy),k.setVisible(!0),j.setPosition(f),j.setVisible(!0),!e&&d.contains(f)){c.panTo(f);var g=c.getZoom();15>g&&c.setZoom(15),e=!0}$("#geolocation-control").addClass("active")},function(a){m(),alert("Unable to get your location. Please try again.")},{enableHighAccuracy:!0,timeout:6e4,maximumAge:5e3})}})}var n=$("#bounds-warning");google.maps.event.addListener(c,"bounds_changed",function(){
var a=c.getBounds();a.intersects(d)?n.removeClass("visible"):n.addClass("visible")}),$("#back-sg").on("click",function(a){a.preventDefault(),n.removeClass("visible"),c.panTo(b),setTimeout(function(){c.fitBounds(d)},300)});var o=$("#places-search-form");o.on("submit",function(a){a.preventDefault()});var p=new google.maps.places.Autocomplete(o.find("input")[0],{bounds:d,componentRestrictions:{country:"sg"}});google.maps.event.addListener(p,"place_changed",function(){$("#search").addClass("hidden");var a=p.getPlace();
a.geometry&&(a.geometry.viewport?c.fitBounds(a.geometry.viewport):(c.setCenter(a.geometry.location),c.setZoom(17)))}),lscache.get("busrouter-intro")||/\w/i.test(location.hash)||$("#intro").removeClass("hidden"),a(null,c)}queue().defer(function(a){var b=document.createElement("script");b.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJii3LssFIl3cw4XzTxtWqSls57rayV5I&libraries=places&callback=loadMap",document.body.appendChild(b),window.loadMap=a}).await(b)}],j=function(a,b){var c={},d={};a.services.forEach(function(a){
var b=a.type;c[b]?c[b].push(a):c[b]=[a],d[a.no]=a});var e=$("#bus-services"),f='<label class="search-field"><svg class="icon"><use xlink:href="#search-icon"></use></svg><input placeholder="Bus service number e.g.: 133" required><a href="#" class="close"><svg class="icon"><use xlink:href="#times"></use></svg></a></label>';for(type in c){var g=c[type];f+="<h2>"+a.types[type]+"</h2><ul>";for(var h=0,i=g.length;i>h;h++){var j=g[h],k=j.no;f+=b?'<li><a href="/#/compare/'+k+"/1"+b+'" id="service-'+k+'">'+k+" <span>"+j.name+"</span></a></li>":'<li><a href="#/services/'+k+'" id="service-'+k+'">'+k+" <span>"+j.name+"</span></a></li>";
}f+="</ul>"}e.html(f);var l=e.find("input"),m=e.find("li a"),n=function(){var a=l.val();m.each(function(b){var c=b.textContent.trim().toLowerCase(),d=c.indexOf(a.toLowerCase())<0;d?$(b).addClass("hidden"):$(b).removeClass("hidden")})};return l.on("input",n),e.find(".close").on("click",function(a){a.preventDefault(),l.val(""),n(),l.focus()}),[d,e]},k=function(a,b){if(a||!b||4!=b.length)return void alert("Oops, an error occured.");var c=b[0],d=b[1],f=b[2],i=b[3],k={};c.forEach(function(a){k[a.no]=a;
});var l=j(d);busServicesMap=l[0],$busServices=l[1];var m,n,o=[],p=[],q={},r=new google.maps.InfoWindow({maxWidth:260}),s=new google.maps.Polyline({clickable:!1,strokeColor:"#f01b48",strokeWeight:5,strokeOpacity:.5}),t=new google.maps.Polyline({clickable:!1,strokeColor:"#0f34b7",strokeWeight:5,strokeOpacity:.5}),u=function(){o.forEach(function(a){a.setMap(null),google.maps.event.clearInstanceListeners(a)}),o=[],p.forEach(function(a){a.setMap(null),google.maps.event.clearInstanceListeners(a)}),p=[];
for(var a in v){var b=v[a];b.setMap(null),google.maps.event.clearInstanceListeners(b)}v={};for(var c in q){var d=q[c];d.setMap(null),google.maps.event.clearInstanceListeners(d)}q={},s.setMap(null),t.setMap(null),r.close()};google.maps.event.addListener(i,"markerClick",function(a){var b=a.marker,c=a.stop,d=a.currentService,e=a.hideShowRoutesLink,g=k[c],h=g.name,j=f[c],l='<div class="infowindow"><h1>'+h+'&nbsp;<span class="tag">'+c+"</span></h1>";j.forEach(function(a){l+=a==d?'<span class="infoservice">'+a+"</span> ":'<a href="#/services/'+a+'" class="infoservice">'+a+"</a> ";
}),l+='<div class="infofooter">',l+='<a href="bus-arrival/#'+c+'" target="_blank" class="show-arrivals"><svg class="icon"><use xlink:href="#clock-o"></use></svg> Show bus arrival times here</a>',j.length>1&&!e&&(l+='<a href="#/stops/'+c+'" class="show-routes"><svg class="icon"><use xlink:href="#code-fork"></use></svg> Show all routes passing here</a>'),l+="</div></div>",r.setContent(l),r.open(i,b)});var v={};google.maps.event.addListener(i,"idle",function(){if("home"==z){var a=$("#bus-stops"),b=i.getZoom();
if(b>=15){$("#bus-stops-section").removeClass("hidden");var d=i.getBounds();for(var f in v){var g=v[f];if(!d.contains(g.getPosition())){g.setMap(null),v[f]=void 0;try{delete v[f]}catch(a){}}}var h=[];if(c.forEach(function(a){var b=a.no;if(!v[b]){var c=new google.maps.LatLng(a.lat,a.lng);if(!d.contains(c))return;var f=new google.maps.Marker({position:c,map:i,title:a.name,icon:e.circle});google.maps.event.addListener(f,"click",function(){google.maps.event.trigger(i,"markerClick",{marker:f,stop:b})}),
v[b]=f}h.push({no:b,stop:a})}),h.length){var j="<ul>";h.sort(function(a,b){var c=a.stop.name,d=b.stop.name;return d>c?-1:c>d?1:0}),h.forEach(function(a){var b=a.no,c=a.stop.name;j+='<li><a class="stop" id="stop-'+b+'"><span class="tag">'+b+"</span> "+c+"</a></li>"}),j+="</ul>",a.html(j)}else a.html("<p>Zoom in or pan around to see bus stops on the map.</p>")}else{for(var f in v)v[f].setMap(null);v=[],a.html("<p>Zoom in or pan around to see bus stops on the map.</p>")}}}),$("#bus-stops").on("click","li a",function(a){
a.preventDefault();var b=$(this).find(".tag").text(),c=v[b],d=c.getPosition();i.panTo(d),google.maps.event.trigger(c,"click")}),$("#bus-stops-section").on("click","a.close",function(a){a.preventDefault(),$("#bus-stops-section").addClass("hidden")});var w,x=$("#bus-routes"),y=document.title,z="home",A=function(a,b,c,d){var h=!!d,j=a.split("/");j[3]=2==c?1:2;var l=j.join("/");if(h){var q=j[4],r=j[5];n=s,s=t,m=o,o=p,z="compare",document.title="Bus service "+b+" and "+q+" - "+y}else n&&(s=n,n=void 0),
m&&(o=m,m=void 0),z="services",document.title="Bus service "+b+" - "+y,c||(c=1);return $busServices.find("a.selected").removeClass("selected"),$("#service-"+b).addClass("selected"),h||u(),$busServicesSection=$("#bus-services-section").addClass("loading"),g("busService-"+b,{no:b},function(g,j){if($busServicesSection.removeClass("loading"),j){var m=j[c],n=m.route,p=m.stops,t=[];if(n&&n.length){for(var u=0,v=n.length;v>u;u++){var y=n[u],z=y.split(","),A=new google.maps.LatLng(parseFloat(z[0],10),parseFloat(z[1],10));
t.push(A)}s.setPath(t),s.setMap(i)}var B='<div class="tab-bar">';j[2]&&j[2].route&&j[2].route.length&&(B+='<a href="#'+(1==c?a:l)+'" class="tab '+(1==c?"selected":"")+'">Route 1</a><a href="#'+(2==c?a:l)+'" class="tab '+(2==c?"selected":"")+'">Route 2</a>'),B+=h?'<a href="">Home</a>':'<a href="#/compare/'+b+"/"+c+'">Compare</a>';var C=busServicesMap[b].operator;if(C){var D="sbs"==C?"http://www.sbstransit.com.sg/journeyplan/servicedetails.aspx?serviceno=":"http://www.transitlink.com.sg/eservice/eguide/service_route.php?service=";
B+='<a href="'+D+b+'" target="_blank" class="details"><svg class="icon"><use xlink:href="#list-alt"></use></svg> Bus schedules</a>'}B+="</div>",B+="<ul>";var E=!1,v=p.length;bounds=new google.maps.LatLngBounds,p.forEach(function(a,c){var d=k[a],g=d.name,j=(f[a],e.circle),l=v-1,m="stop";if(0==c){var n=p[l],q=k[n];g==q.name?(E=!0,j=e.dot,m="stop-dot"):(j=e.a,m="stop-a")}else c==l&&(E?(j=e.dot,m="stop-dot"):(j=e.b,m="stop-b"));if(c==l&&E)o.push(o[0]);else{var r=new google.maps.LatLng(d.lat,d.lng),s=new google.maps.Marker({
position:r,map:i,icon:j,title:g,animation:0==c||c==l||h?google.maps.Animation.DROP:null,zIndex:0==c||c==l?5:1});google.maps.event.addListener(s,"click",function(){google.maps.event.trigger(i,"markerClick",{marker:s,stop:a,currentService:b}),x.find("li a.selected").removeClass("selected"),$(".stop-"+a+'[data-index="'+c+'"]').addClass("selected").focus()}),o.push(s),bounds.extend(r)}B+='<li><a tabindex="0" href="#" class="'+m+" stop-"+a+'" data-index="'+c+'"><i></i><span class="tag">'+a+"</span> "+g+"</a></li>";
}),h&&bounds.union(d),x.html(B+"</ul>"),x[0].scrollTop=0,$("#bus-routes-section h1 b").text(b),h&&(document.getElementsByClassName("back")[0].href="#/compare/"+q+"/"+r),$("section.extra").addClass("hidden"),$("#bus-routes-section").removeClass("hidden"),b==w&&bounds.contains(i.getCenter())||(w=b,i.panTo(bounds.getCenter()),setTimeout(function(){i.fitBounds(bounds)},400)),lscache.set("busService-"+b,j,1440)}}),bounds};ruto.config({notfound:function(){ruto.go("/")}}).add("/",function(){z="home",document.title=y,
$("section.extra").addClass("hidden"),$("body").removeClass("header-collapsed"),u(),setTimeout(function(){$busServices.find("a.selected").removeClass("selected")},400)}).add(/^\/services\/(\w+)\/?(\d)?$/i,function(a,b,c){A(a,b,c)}).add(/^\/compare\/(\w+)\/(\d)$/i,function(a,b,c){A(a,b,c),$("#bus-routes-section").addClass("hidden");var e=j(d,a.slice("/compare".length,1/0));busServicesMap=e[0],$busServices=e[1]}).add(/^\/compare\/(\w+)\/(\d)\/(\w+)\/(\d)$/i,function(a,b,c,d,e){boundsOld=A(a,d,e),A(a,b,c,boundsOld);
}).add(/^\/stops\/(\w+)$/i,function(a,b){z="stops",document.title="Bus stop "+b+" - "+y,u(),$("#bus-stop-routes-section").removeClass("hidden").addClass("loading").find("h1 b").text(b);var c=k[b],d=new google.maps.LatLng(c.lat,c.lng),h=new google.maps.Marker({position:d,map:i,icon:e.dot,title:c.name,animation:google.maps.Animation.DROP});google.maps.event.addListener(h,"click",function(){google.maps.event.trigger(i,"markerClick",{marker:h,stop:b,hideShowRoutesLink:!0})}),o.push(h);var j=f[b],l=new google.maps.LatLngBounds,m="",n=function(a,c){
var d=a[1],e=d.stops;-1!=e.indexOf(b)&&e[e.length-1]!=b||(d=a[2],e=d.stops,-1==e.indexOf(b)&&(d=a[1],e=d.stops)),e.forEach(function(a){var b=k[a];l.extend(new google.maps.LatLng(b.lat,b.lng))});var f=d.route;if(f){for(var g=[],h=0,j=f.length;j>h;h++){var n=f[h],o=n.split(","),p=new google.maps.LatLng(parseFloat(o[0],10),parseFloat(o[1],10));g.push(p)}var r=new google.maps.Polyline({strokeColor:"#f01b48",strokeWeight:5,strokeOpacity:.4,path:g,map:i});google.maps.event.addListener(r,"mouseover",function(){
$("#stop-service-"+c).trigger("mouseover").focus()}),google.maps.event.addListener(r,"mouseout",function(){$("#stop-service-"+c).trigger("mouseout").blur()}),google.maps.event.addListener(r,"click",function(){location.href=$("#stop-service-"+c).attr("href")}),q[c]=r,m+='<li><a href="#/services/'+c+'" id="stop-service-'+c+'"><span class="tag">'+c+"</span> "+busServicesMap[c].name+"</a></li>"}},p=queue();j.forEach(function(a){p.defer(function(b){g("busService-"+a,{no:a},function(c,d){n(d,a),b()})});
}),p.awaitAll(function(){i.fitBounds(l),$("#bus-stop-routes-section").removeClass("loading"),$("#bus-stop-routes").html("<ul>"+m+"</ul>")})}).init(),$("#bus-routes").on("click","li a",function(a){a.preventDefault();var b=$(this).data("index"),c=o[b];if(c){var d=c.getPosition();i.getZoom()<15&&i.setZoom(15),i.panTo(d),google.maps.event.trigger(c,"click"),h&&$("#header-sidebar").trigger("click")}}),$("#bus-stop-routes").on("mouseover touchstart","li a",function(){var a=$(this).find(".tag").text();for(var b in q){
var c=q[b];b==a?c.setOptions({strokeOpacity:.8}):c.setOptions({strokeOpacity:.1})}}).on("mouseout touchend touchcancel","li a",function(){for(var a in q)q[a].setOptions({strokeOpacity:.4})}),$(document).on("keyup",function(a){if(/services\/.+/i.test(location.hash)&&(!a.target.tagName||"input"!=a.target.tagName.toLowerCase())){var b=a.keyCode;switch(b){case 39:case 40:var c=x.find("li a.selected");if(!c.length)return;c.removeClass("selected");var d=c.parent().next();if(!d.length)return;d.find("a").trigger("click");
break;case 37:case 38:var c=x.find("li a.selected");if(!c.length)return;c.removeClass("selected");var e=c.parent().prev();if(!e.length)return;e.find("a").trigger("click")}}}),$("#sidebar").on("click",function(a){var b=a.target,c=b.tagName.toLowerCase();("h1"==c||"b"==c&&"h1"==b.parentNode.tagName.toLowerCase())&&(a.preventDefault(),$("body").toggleClass("sidebar-collapsed"),setTimeout(function(){google.maps.event.trigger(i,"resize")},300))})},l=queue();i.forEach(function(a){l.defer(a)}),l.awaitAll(k),
$("#logo").on("click",function(){$("body").toggleClass("header-collapsed")}),$("#header-about").on("click",function(){$("#about").removeClass("hidden")}),$("#header-search").on("click",function(){$("#search").removeClass("hidden"),$("#places-search-form input").focus()}),$("#intro .explore").on("click",function(){lscache.set("busrouter-intro",!0),$("#intro").addClass("hidden")}),$("#about .close").on("click",function(){$("#about").addClass("hidden")}),$("#search .close").on("click",function(){$("#search").addClass("hidden");
}),$("#map").on("click","a.show-arrivals",function(a){a.preventDefault();var b=320,c=480,d=((screen.availHeight||screen.height)-c)/2,e=(screen.width-b)/2;window.open(this.href,"busArrivals"+new Date,"width="+b+",height="+c+",menubar=0,toolbar=0,top="+d+",left="+e)}),$(".share-buttons a").on("click",function(a){var b=a.target;if(b.href){a.preventDefault();var c=500,d=300,e=((screen.availHeight||screen.height)-d)/2,f=(screen.width-c)/2;window.open(b.href,"window-"+Math.random(),"width="+c+",height="+d+",menubar=0,toolbar=0,top="+e+",left="+f);
}})}}();
//# sourceMappingURL=scripts.js.map